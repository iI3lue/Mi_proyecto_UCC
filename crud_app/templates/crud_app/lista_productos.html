{% extends 'crud_app/base.html' %}
{% load static %}
{% load custom_filters %}

{% block title %}Cat√°logo de Productos - TechStore{% endblock %}

{% block contenido %}
<div class="container" style="margin-top: 2rem;">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
    <div>
      <h1 class="page-title" style="text-align: left; margin-bottom: 0.5rem;">üì¶ Cat√°logo Completo</h1>
      <p style="color: var(--text-secondary); margin: 0;">Todos nuestros productos disponibles</p>
    </div>
    
    {% if user.is_staff %}
    <a href="{% url 'crear_producto' %}" class="btn btn-success">
      ‚ûï Agregar Nuevo Producto
    </a>
    {% endif %}
  </div>
  
  {% if productos %}
  <div class="products-grid">
    {% for producto in productos %}
    <div class="product-card">
      <div class="product-image-container">
        {% if producto.imagen %}
          <img src="{{ producto.imagen.url }}" alt="{{ producto.nombre }}" class="product-image">
        {% else %}
          <img src="https://via.placeholder.com/280x250?text=Sin+Imagen" alt="Sin imagen" class="product-image">
        {% endif %}
        
        <div class="product-badge">{{ producto.marca }}</div>
        
        {% if producto.stock > 0 %}
          {% if producto.stock < 5 %}
            <div class="stock-badge low-stock">Solo {{ producto.stock }} disponibles</div>
          {% else %}
            <div class="stock-badge">En Stock ({{ producto.stock }})</div>
          {% endif %}
        {% else %}
          <div class="stock-badge out-of-stock">Agotado</div>
        {% endif %}
      </div>
      
      <div class="product-content">
        <div class="product-category">{{ producto.categoria }}</div>
        <h3 class="product-title">{{ producto.nombre }}</h3>
        <div class="product-brand">{{ producto.marca }}</div>
        <p class="product-description">{{ producto.descripcion|truncatewords:12 }}</p>
        
        <div class="product-footer">
          <div class="product-price">
            {{ producto.precio|currency_cop }}
          </div>
          <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
            <a href="{% url 'producto_detalle' producto.pk %}" class="btn btn-outline btn-sm">
              üëÅÔ∏è Ver
            </a>
            {% if producto.stock > 0 %}
              <button onclick="addToCart({{ producto.pk }}, this)" class="btn btn-primary btn-sm">
                üõí Agregar
              </button>
            {% else %}
              <button class="btn btn-sm" disabled style="background-color: var(--border-color); cursor: not-allowed;">
                Agotado
              </button>
            {% endif %}
          </div>
        </div>
        
        {% if user.is_staff %}
        <div style="display: flex; gap: 0.5rem; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-color);">
          <a href="{% url 'actualizar_producto' producto.pk %}" class="btn btn-sm" style="flex: 1; background-color: var(--warning); color: white;">
            ‚úèÔ∏è Editar
          </a>
          <a href="{% url 'eliminar_producto' producto.pk %}" class="btn btn-danger btn-sm" style="flex: 1;">
            üóëÔ∏è Eliminar
          </a>
        </div>
        {% endif %}
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="empty-state">
    <div class="empty-state-icon">üì¶</div>
    <div class="empty-state-text">No hay productos disponibles en este momento</div>
    {% if user.is_staff %}
    <a href="{% url 'crear_producto' %}" class="btn btn-primary">Agregar Primer Producto</a>
    {% endif %}
  </div>
  {% endif %}
</div>
{% endblock %}
