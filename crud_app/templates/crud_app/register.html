{% extends 'crud_app/base.html' %}
{% load static %}

{% block title %}Registro - TechStore{% endblock %}

{% block contenido %}
<div class="container" style="margin-top: 3rem; margin-bottom: 3rem;">
  <div style="max-width: 550px; margin: 0 auto;">
    <!-- Card de Registro -->
    <div style="background-color: var(--card-bg); padding: 3rem; border-radius: var(--radius-lg); box-shadow: var(--shadow-lg);">
      <div style="text-align: center; margin-bottom: 2rem;">
        <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“</div>
        <h1 style="font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem; color: var(--text-primary);">
          Crear Cuenta
        </h1>
        <p style="color: var(--text-secondary); margin: 0;">
          Ãšnete a TechStore y comienza a comprar
        </p>
      </div>
      
      <form method="POST" id="registerForm" style="display: flex; flex-direction: column; gap: 1.5rem;">
        {% csrf_token %}
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
          <div class="form-group">
            <label class="form-label" for="username">Usuario</label>
            <input 
              type="text" 
              class="form-control" 
              name="username" 
              id="username"
              placeholder="Tu nombre de usuario"
              required 
              autofocus
            >
          </div>
          
          <div class="form-group">
            <label class="form-label" for="email">Correo</label>
            <input 
              type="email" 
              class="form-control" 
              name="email" 
              id="email"
              placeholder="tu@email.com"
              required
            >
          </div>
        </div>
        
        <div class="form-group">
          <label class="form-label" for="password1">ContraseÃ±a</label>
          <div style="position: relative;">
            <input 
              type="password" 
              class="form-control" 
              name="password1" 
              id="password1"
              placeholder="Crea una contraseÃ±a segura"
              required
            >
            <button 
              type="button" 
              class="btn btn-icon" 
              id="togglePassword1"
              style="position: absolute; right: 5px; top: 50%; transform: translateY(-50%); background: transparent; box-shadow: none;"
            >
              ğŸ‘ï¸
            </button>
          </div>
          <div style="margin-top: 0.5rem; height: 4px; background-color: var(--border-color); border-radius: 2px; overflow: hidden;">
            <div id="passwordStrengthBar" style="height: 100%; width: 0%; transition: all 0.3s ease;"></div>
          </div>
          <small id="passwordStrengthText" style="display: block; margin-top: 0.25rem; font-size: 0.85rem;"></small>
        </div>
        
        <div class="form-group">
          <label class="form-label" for="password2">Confirmar ContraseÃ±a</label>
          <div style="position: relative;">
            <input 
              type="password" 
              class="form-control" 
              name="password2" 
              id="password2"
              placeholder="Repite tu contraseÃ±a"
              required
            >
            <button 
              type="button" 
              class="btn btn-icon" 
              id="togglePassword2"
              style="position: absolute; right: 5px; top: 50%; transform: translateY(-50%); background: transparent; box-shadow: none;"
            >
              ğŸ‘ï¸
            </button>
          </div>
          <small id="passwordError" style="color: var(--danger); display: block; margin-top: 0.25rem;"></small>
        </div>
        
        <button type="submit" class="btn btn-success btn-lg" style="width: 100%;">
          Crear mi cuenta â†’
        </button>
      </form>
      
      <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--border-color); text-align: center;">
        <p style="color: var(--text-secondary); margin: 0;">
          Â¿Ya tienes cuenta? 
          <a href="{% url 'login' %}" style="color: var(--accent-blue); text-decoration: none; font-weight: 600;">
            Inicia sesiÃ³n
          </a>
        </p>
      </div>
    </div>
    
    <!-- Link de regreso -->
    <div style="text-align: center; margin-top: 2rem;">
      <a href="{% url 'index' %}" style="color: var(--text-secondary); text-decoration: none;">
        â† Volver al inicio
      </a>
    </div>
  </div>
</div>

<script>
  const password1 = document.getElementById('password1');
  const password2 = document.getElementById('password2');
  const passwordError = document.getElementById('passwordError');
  const form = document.getElementById('registerForm');
  const strengthBar = document.getElementById('passwordStrengthBar');
  const strengthText = document.getElementById('passwordStrengthText');

  // Toggle de visibilidad de contraseÃ±as
  document.getElementById('togglePassword1').addEventListener('click', function () {
    const type = password1.getAttribute('type') === 'password' ? 'text' : 'password';
    password1.setAttribute('type', type);
    this.textContent = type === 'password' ? 'ğŸ‘ï¸' : 'ğŸ™ˆ';
  });
  
  document.getElementById('togglePassword2').addEventListener('click', function () {
    const type = password2.getAttribute('type') === 'password' ? 'text' : 'password';
    password2.setAttribute('type', type);
    this.textContent = type === 'password' ? 'ğŸ‘ï¸' : 'ğŸ™ˆ';
  });

  // Validar coincidencia de contraseÃ±as
  password2.addEventListener('keyup', function () {
    if (password2.value.length > 0) {
      passwordError.textContent = (password1.value !== password2.value) ? 'âš  Las contraseÃ±as no coinciden' : 'âœ“ Las contraseÃ±as coinciden';
      passwordError.style.color = (password1.value !== password2.value) ? 'var(--danger)' : 'var(--success)';
    } else {
      passwordError.textContent = '';
    }
  });

  // Validar antes de enviar
  form.addEventListener('submit', function (event) {
    if (password1.value !== password2.value) {
      event.preventDefault();
      passwordError.textContent = 'âš  Las contraseÃ±as no coinciden';
      passwordError.style.color = 'var(--danger)';
      return false;
    }
  });

  // Medidor de fortaleza de contraseÃ±a
  password1.addEventListener('keyup', function () {
    const val = password1.value;
    let strength = 0;
    
    if (val.length >= 6) strength++;
    if (/[A-Z]/.test(val)) strength++;
    if (/[0-9]/.test(val)) strength++;
    if (/[@$!%*?&#]/.test(val)) strength++;

    if (strength === 0 || val.length === 0) { 
      strengthBar.style.width = '0%'; 
      strengthBar.style.backgroundColor = 'var(--danger)'; 
      strengthText.textContent = ''; 
      strengthText.style.color = 'var(--text-secondary)';
    }
    else if (strength <= 1) { 
      strengthBar.style.width = '33%'; 
      strengthBar.style.backgroundColor = 'var(--danger)'; 
      strengthText.textContent = 'ğŸ”´ ContraseÃ±a dÃ©bil'; 
      strengthText.style.color = 'var(--danger)';
    }
    else if (strength == 2) { 
      strengthBar.style.width = '66%'; 
      strengthBar.style.backgroundColor = 'var(--warning)'; 
      strengthText.textContent = 'ğŸŸ¡ ContraseÃ±a media'; 
      strengthText.style.color = 'var(--warning)';
    }
    else { 
      strengthBar.style.width = '100%'; 
      strengthBar.style.backgroundColor = 'var(--success)'; 
      strengthText.textContent = 'ğŸŸ¢ ContraseÃ±a fuerte'; 
      strengthText.style.color = 'var(--success)';
    }
  });
</script>
{% endblock %}
