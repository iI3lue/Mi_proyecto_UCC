{% extends 'crud_app/base.html' %}
{% block contenido %}
<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <h2 class="text-center mb-4">Registro de Usuario</h2>
      <form method="POST" id="registerForm">
        {% csrf_token %}
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label">Usuario</label>
            <input type="text" class="form-control" name="username" required>
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label">Correo</label>
            <input type="email" class="form-control" name="email" required>
          </div>
        </div>
        <div class="mb-3">
          <label class="form-label">Contraseña</label>
          <div class="input-group">
            <input type="password" class="form-control" name="password1" id="password1" required>
            <button type="button" class="btn btn-outline-secondary" id="togglePassword1">👁️</button>
          </div>
          <div class="progress mb-2">
            <div id="passwordStrengthBar" class="progress-bar" role="progressbar" style="width: 0%;"></div>
          </div>
          <small id="passwordStrengthText"></small>
        </div>
        <div class="mb-3">
          <label class="form-label">Confirmar Contraseña</label>
          <div class="input-group">
            <input type="password" class="form-control" name="password2" id="password2" required>
            <button type="button" class="btn btn-outline-secondary" id="togglePassword2">👁️</button>
          </div>
          <small id="passwordError" class="text-danger"></small>
        </div>
        <div class="d-grid mb-3">
          <button type="submit" class="btn btn-success">Registrarse</button>
        </div>
        <p class="text-center">¿Ya tienes cuenta? <a href="{% url 'login' %}">Inicia sesión</a></p>
      </form>
    </div>
  </div>
</div>
<script>
  const password1 = document.getElementById('password1');
  const password2 = document.getElementById('password2');
  const passwordError = document.getElementById('passwordError');
  const form = document.getElementById('registerForm');
  const strengthBar = document.getElementById('passwordStrengthBar');
  const strengthText = document.getElementById('passwordStrengthText');

  document.getElementById('togglePassword1').addEventListener('click', function () {
    const type = password1.getAttribute('type') === 'password' ? 'text' : 'password';
    password1.setAttribute('type', type);
    this.textContent = type === 'password' ? '👁️' : '🙈';
  });
  document.getElementById('togglePassword2').addEventListener('click', function () {
    const type = password2.getAttribute('type') === 'password' ? 'text' : 'password';
    password2.setAttribute('type', type);
    this.textContent = type === 'password' ? '👁️' : '🙈';
  });

  password2.addEventListener('keyup', function () {
    passwordError.textContent = (password1.value !== password2.value) ? '⚠ Las contraseñas no coinciden' : '';
  });

  form.addEventListener('submit', function (event) {
    event.preventDefault();
    if (password1.value !== password2.value) {
      passwordError.textContent = '⚠ Las contraseñas no coinciden';
      return;
    }
    Swal.fire({
      title: '¿Registrar cuenta?',
      text: 'Se guardarán tus datos y podrás iniciar sesión.',
      icon: 'question',
      showCancelButton: true,
      confirmButtonText: 'Sí, registrarme',
      cancelButtonText: 'Cancelar',
    }).then((result) => {
      if (result.isConfirmed) form.submit();
    });
  });

  password1.addEventListener('keyup', function () {
    const val = password1.value;
    let strength = 0;
    if (val.length >= 6) strength++;
    if (/[A-Z]/.test(val)) strength++;
    if (/[0-9]/.test(val)) strength++;
    if (/[@$!%*?&#]/.test(val)) strength++;

    if (strength === 0) { strengthBar.style.width = '0%'; strengthBar.className = 'progress-bar bg-danger'; strengthText.textContent = ''; }
    else if (strength <= 1) { strengthBar.style.width = '33%'; strengthBar.className = 'progress-bar bg-danger'; strengthText.textContent = 'Contraseña débil'; }
    else if (strength == 2) { strengthBar.style.width = '66%'; strengthBar.className = 'progress-bar bg-warning'; strengthText.textContent = 'Contraseña media'; }
    else { strengthBar.style.width = '100%'; strengthBar.className = 'progress-bar bg-success'; strengthText.textContent = 'Contraseña fuerte'; }
  });
</script>
{% endblock %}
