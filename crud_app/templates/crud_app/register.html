{% extends 'crud_app/base.html' %}
{% block contenido %}
<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <h2 class="text-center mb-4">Registro de Usuario</h2>
      <form method="POST" id="registerForm">
        {% csrf_token %}
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label">Usuario</label>
            <input type="text" class="form-control" name="username" required>
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label">Correo</label>
            <input type="email" class="form-control" name="email" required>
          </div>
        </div>
        <div class="mb-3">
          <label class="form-label">ContraseÃ±a</label>
          <div class="input-group">
            <input type="password" class="form-control" name="password1" id="password1" required>
            <button type="button" class="btn btn-outline-secondary" id="togglePassword1">ğŸ‘ï¸</button>
          </div>
          <div class="progress mb-2">
            <div id="passwordStrengthBar" class="progress-bar" role="progressbar" style="width: 0%;"></div>
          </div>
          <small id="passwordStrengthText"></small>
        </div>
        <div class="mb-3">
          <label class="form-label">Confirmar ContraseÃ±a</label>
          <div class="input-group">
            <input type="password" class="form-control" name="password2" id="password2" required>
            <button type="button" class="btn btn-outline-secondary" id="togglePassword2">ğŸ‘ï¸</button>
          </div>
          <small id="passwordError" class="text-danger"></small>
        </div>
        <div class="d-grid mb-3">
          <button type="submit" class="btn btn-success">Registrarse</button>
        </div>
        <p class="text-center">Â¿Ya tienes cuenta? <a href="{% url 'login' %}">Inicia sesiÃ³n</a></p>
      </form>
    </div>
  </div>
</div>
<script>
  const password1 = document.getElementById('password1');
  const password2 = document.getElementById('password2');
  const passwordError = document.getElementById('passwordError');
  const form = document.getElementById('registerForm');
  const strengthBar = document.getElementById('passwordStrengthBar');
  const strengthText = document.getElementById('passwordStrengthText');

  document.getElementById('togglePassword1').addEventListener('click', function () {
    const type = password1.getAttribute('type') === 'password' ? 'text' : 'password';
    password1.setAttribute('type', type);
    this.textContent = type === 'password' ? 'ğŸ‘ï¸' : 'ğŸ™ˆ';
  });
  document.getElementById('togglePassword2').addEventListener('click', function () {
    const type = password2.getAttribute('type') === 'password' ? 'text' : 'password';
    password2.setAttribute('type', type);
    this.textContent = type === 'password' ? 'ğŸ‘ï¸' : 'ğŸ™ˆ';
  });

  password2.addEventListener('keyup', function () {
    passwordError.textContent = (password1.value !== password2.value) ? 'âš  Las contraseÃ±as no coinciden' : '';
  });

  form.addEventListener('submit', function (event) {
    event.preventDefault();
    if (password1.value !== password2.value) {
      passwordError.textContent = 'âš  Las contraseÃ±as no coinciden';
      return;
    }
    Swal.fire({
      title: 'Â¿Registrar cuenta?',
      text: 'Se guardarÃ¡n tus datos y podrÃ¡s iniciar sesiÃ³n.',
      icon: 'question',
      showCancelButton: true,
      confirmButtonText: 'SÃ­, registrarme',
      cancelButtonText: 'Cancelar',
    }).then((result) => {
      if (result.isConfirmed) form.submit();
    });
  });

  password1.addEventListener('keyup', function () {
    const val = password1.value;
    let strength = 0;
    if (val.length >= 6) strength++;
    if (/[A-Z]/.test(val)) strength++;
    if (/[0-9]/.test(val)) strength++;
    if (/[@$!%*?&#]/.test(val)) strength++;

    if (strength === 0) { strengthBar.style.width = '0%'; strengthBar.className = 'progress-bar bg-danger'; strengthText.textContent = ''; }
    else if (strength <= 1) { strengthBar.style.width = '33%'; strengthBar.className = 'progress-bar bg-danger'; strengthText.textContent = 'ContraseÃ±a dÃ©bil'; }
    else if (strength == 2) { strengthBar.style.width = '66%'; strengthBar.className = 'progress-bar bg-warning'; strengthText.textContent = 'ContraseÃ±a media'; }
    else { strengthBar.style.width = '100%'; strengthBar.className = 'progress-bar bg-success'; strengthText.textContent = 'ContraseÃ±a fuerte'; }
  });
</script>
{% endblock %}
